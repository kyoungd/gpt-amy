import React from 'react';
import PropTypes from 'prop-types';
import NoEditForm from '../components/DataEntryForm/NoEditForm';
import PageReportRoot from './PageReportRoot';


function removeColumnByKey(rows, columns, key) {
    // Find the index of the column with the given key
    const filteredColumns = columns.filter(column => column.key !== key);
    const filteredRows = rows.map(row => {
        // Remove the key from object
        delete row[key];
        return row;
    });
    return { rows: filteredRows, columns: filteredColumns };
}

function addColorColumn(rows, columns) {
    // Update each row with the new 'color' value
    const updatedRows = rows.map(row => {
        let color = 'yellow'; // default color
        if (parseInt(row.completed) > 0 && parseInt(row.incomplete) === 0) {
            color = 'blue';
        } else if (parseInt(row.completed) === 0 && parseInt(row.incomplete) > 0) {
            color = 'green';
        }
        return {...row, color};
    });

    // Add the new 'color' column
    columns.push({ name: 'Email', key: 'color' });

    return { rows: updatedRows, columns };
}


PageReport.propTypes = {
    jwt: PropTypes.string.isRequired,
    classOption: PropTypes.string
};

function PageReport ({jwt, classOption}) {
    const title = "HOME REPLACEMENT COST REPORT";
    const apipath = "reports";

    const filterFunc = (rows, columns) => {
        try {
            const step1 = addColorColumn(rows, columns);
            const step2 = removeColumnByKey(step1.rows, step1.columns, 'completed');
            const result = removeColumnByKey(step2.rows, step2.columns, 'incomplete');
            return { filteredRows: result.rows, filteredColumns: result.columns };
        }
        catch (error) {
            console.log(error);
            return { rows, columns };
        }
    }
    
    return (
        <React.Fragment>
            <PageReportRoot
                jwt={jwt}
                title={title}
                apipath={apipath}
                classOption={classOption}
                EditComponent={NoEditForm}
                FilterDataFunc={filterFunc}
            />
        </React.Fragment>
    )
}

export default PageReport;
